baudrate=115200
loadaddr=0x43100000
ipaddr=192.168.1.1
serverip=192.168.1.254
ethaddr=aa:bb:cc:dd:ee:ff
file_bl2=preloader.bin
file_fip=bl31-uboot.fip
file_firmware=firmware.bin
file_initramfs=initramfs.bin
bootcmd=run ubi_read_firmware && bootm $loadaddr
bootmenu_0=[36m[1mRun default boot command[0m=run bootcmd ; run tftp_restore_system
bootmenu_1=[36m[1mBoot system from Flash[0m=run bootcmd ; run confirm_return
bootmenu_2=[32m[1mBoot system from TFTP[0m=run tftp_load_initramfs ; run confirm_return
bootmenu_3=[32m[1mLoad system via TFTP then write to flash[0m=run tftp_restore_system ; run confirm_return
bootmenu_4=[33m[1mLoad BL2 via TFTP then write to flash[0m=run tftp_update_bl2 ; run confirm_return
bootmenu_5=[33m[1mLoad FIP via TFTP then write to flash[0m=run tftp_update_fip ; run confirm_return
bootmenu_6=[31m[1mReboot[0m=reset
confirm_continue=askenv confirm [35m[1mConfirm to write to Flash? [Y/n][0m 1 && flag=$confirm && setenv confirm && test x$flag = xy || test x$flag = xY
confirm_return=askenv - [35m[1mPress ENTER to return to menu![0m ; bootmenu 60
nand_cal_ersize=setexpr ersize 0x$filesize + 0x1ffff && setexpr ersize 0x$ersize / 0x20000 && setexpr ersize 0x$ersize * 0x20000
nand_verify_bl2=mtd read bl2 $loadaddr && md5sum $loadaddr 0x$filesize
nand_verify_fip=mtd read fip $loadaddr && md5sum $loadaddr 0x$filesize
nand_write_bl2=md5sum $loadaddr 0x$filesize && run confirm_continue && mtd erase bl2 && mtd write bl2 $loadaddr 0x0 0x$filesize && run nand_verify_bl2
nand_write_fip=md5sum $loadaddr 0x$filesize && run confirm_continue && mtd erase fip && mtd write fip $loadaddr 0x0 0x$filesize && run nand_verify_fip
nand_write_firmware=ubi detach ; run nand_cal_ersize && mtd erase ubi 0x0 0x$ersize && setenv ersize && mtd write ubi $loadaddr 0x0 0x$filesize
setup_netconsole=setenv bootdelay 120 && setenv ncip $serverip && setenv stdin nc && setenv stdout nc && setenv stderr nc
tftp_load_initramfs=tftpboot $loadaddr $file_initramfs && bootm $loadaddr
tftp_load_initramfs_loop=while true ; do run tftp_load_initramfs ; sleep 3 ; done
tftp_restore_system=tftpboot $loadaddr $file_firmware && run nand_write_firmware && run bootcmd
tftp_restore_system_loop=while true ; do run tftp_restore_system ; sleep 3 ; done
tftp_update_bl2=mw.b $loadaddr 0xff 0x200000 && tftpboot $loadaddr $file_bl2 && run nand_write_bl2
tftp_update_fip=mw.b $loadaddr 0xff 0x100000 && tftpboot $loadaddr $file_fip && run nand_write_fip
ubi_read_firmware=ubi part ubi && ubi read $loadaddr kernel
ubi_reset=ubi part ubi && ubi check rootfs_data && ubi remove rootfs_data && ubi create rootfs_data - dynamic && reset
