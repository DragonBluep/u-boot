baudrate=115200
loadaddr=84000000
ipaddr=192.168.1.1
serverip=192.168.1.254
ethaddr=aa:bb:cc:dd:ee:ff
file_bl=u-boot.bin
file_fw=firmware.bin
file_ik=initramfs-kernel.bin
bootcmd=run mmap_read_fw && bootm $loadaddr
bootmenu_0=[36m[1mExec default boot command[0m=run bootcmd; echo [31m[1mBoot failed![0m; sleep 3; reset
bootmenu_1=[36m[1mBoot system from Flash[0m=run bootcmd; echo [31m[1mBoot failed![0m; pause; bootmenu 60
bootmenu_2=[32m[1mLoad initramfs image via TFTP then boot[0m=run tftp_boot_ik; pause; bootmenu 60
bootmenu_3=[32m[1mLoad system via TFTP then write to Flash[0m=run tftp_update_fw; pause; bootmenu 60
bootmenu_4=[33m[1mLoad U-Boot via TFTP then write to Flash[0m=run tftp_update_bl; pause; bootmenu 60
bootmenu_5=[33m[1mLoad U-Boot via UART then write to Flash[0m=run uart_update_bl; pause; bootmenu 60
bootmenu_6=[35m[1mReboot[0m=reset
check_bl_integrity=if run md5_verify_bl; then echo [31m[1mU-Boot upgrade successful![0m; else echo [31m[1mU-Boot upgrade failed![0m; fi
continue_or_not=askenv token [31m[1mContinue? [Y/n][0m 1 && char=$token && setenv token; test x$char = xy || test x$char = xY
initcmd=run set_macaddr && setenv set_macaddr && setenv initcmd
md5_verify_bl=md5sum $loadaddr $filesize sum && hash=$sum && setenv sum && mtd read u-boot $loadaddr && md5sum -v $loadaddr $filesize $hash
mmap_read_fw=cp.b bc050000 $loadaddr 10000 && imsz $loadaddr iosize && cp.b bc050000 $loadaddr $iosize && setenv iosize
nor_prep_erase=setexpr iosize $filesize + ffff && setexpr iosize $iosize / 10000 && setexpr iosize $iosize * 10000
nor_write_bl=run continue_or_not && mtd erase u-boot && mtd write u-boot $loadaddr 0 $filesize
nor_write_fw=run nor_prep_erase && mtd erase firmware 0 $iosize && setenv iosize && mtd write firmware $loadaddr 0 $filesize
set_macaddr=mtd read factory $loadaddr && setexpr ptr $loadaddr + 8004 && readmem -b ethaddr $ptr && setenv ptr
setup_netcon=setenv ncip $serverip && setenv stdin nc && setenv stdout nc && setenv stderr nc
setup_uartcon=setenv stderr serial@10000c00 && setenv stdout serial@10000c00 && setenv stdin serial@10000c00 && setenv ncip
switch_console=if test x$stdin = xnc; then run setup_uartcon && setenv bootdelay; else run setup_netcon && setenv bootdelay 60; fi
tftp_boot_ik=while true; do tftpboot $loadaddr $file_ik && bootm $loadaddr; sleep 3; done
tftp_update_bl=tftpboot $loadaddr $file_bl && run nor_write_bl && run check_bl_integrity
tftp_update_fw=while true; do tftpboot $loadaddr $file_fw && run nor_write_fw && run bootcmd; sleep 3; done
uart_update_bl=loadx $loadaddr $baudrate && run nor_write_bl && run check_bl_integrity
