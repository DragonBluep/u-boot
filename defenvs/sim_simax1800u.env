baudrate=115200
loadaddr=0x86000000
ipaddr=192.168.1.1
serverip=192.168.1.254
ethaddr=aa:bb:cc:dd:ee:ff
file_bootloader=u-boot.bin
file_firmware=firmware.bin
file_initramfs=initramfs.bin
bootcmd=run nand_read_firmware || run ubi_read_firmware && bootm $loadaddr
bootmenu_0=[36m[1mRun default boot command[0m=run bootcmd ; run tftp_restore_system
bootmenu_1=[36m[1mBoot system from Flash[0m=run bootcmd ; run confirm_return
bootmenu_2=[32m[1mBoot system from TFTP[0m=run tftp_load_initramfs ; run confirm_return
bootmenu_3=[32m[1mLoad system via TFTP then write to flash[0m=run tftp_restore_system ; run confirm_return
bootmenu_4=[33m[1mLoad U-Boot via TFTP then write to flash[0m=run tftp_update_uboot ; run confirm_return
bootmenu_5=[33m[1mLoad U-Boot via TTL then write to flash[0m=run uart_update_uboot ; run confirm_return
bootmenu_6=[31m[1mReboot[0m=reset
confirm_continue=askenv confirm [35m[1mConfirm to write to Flash? [Y/n][0m 1 && flag=$confirm && setenv confirm && test x$flag = xy || test x$flag = xY
confirm_return=askenv - [35m[1mPress ENTER to return to menu![0m ; bootmenu 60
nand_cal_ersize=setexpr ersize 0x$filesize + 0x1ffff && setexpr ersize 0x$ersize / 0x20000 && setexpr ersize 0x$ersize * 0x20000
nand_read_firmware=mtd read firmware $loadaddr 0x0 0x20000 && imsz $loadaddr image_size && mtd read firmware $loadaddr 0x0 $image_size && setenv image_size
nand_verify_uboot=mtd read u-boot $loadaddr && md5sum $loadaddr 0x$filesize
nand_write_firmware=ubi detach ; run nand_cal_ersize && mtd erase firmware 0x0 0x$ersize && setenv ersize && mtd write firmware $loadaddr 0x0 0x$filesize
nand_write_uboot=md5sum $loadaddr 0x$filesize && run confirm_continue && mtd erase u-boot && mtd write u-boot $loadaddr 0x0 0x$filesize && run nand_verify_uboot
setup_netconsole=setenv bootdelay 120 && setenv ncip $serverip && setenv stdin nc && setenv stdout nc && setenv stderr nc
tftp_load_initramfs=tftpboot $loadaddr $file_initramfs && bootm $loadaddr
tftp_load_initramfs_loop=while true ; do run tftp_load_initramfs ; sleep 3 ; done
tftp_restore_system=tftpboot $loadaddr $file_firmware && run nand_write_firmware && run bootcmd
tftp_restore_system_loop=while true ; do run tftp_restore_system ; sleep 3 ; done
tftp_update_uboot=mw.b $loadaddr 0xff 0x80000 && tftpboot $loadaddr $file_bootloader && run nand_write_uboot
uart_update_uboot=mw.b $loadaddr 0xff 0x80000 && loadx $loadaddr $baudrate && run nand_write_uboot
ubi_read_firmware=ubi part firmware && ubi read $loadaddr kernel
ubi_reset=run nand_read_firmware || ubi part firmware && ubi check rootfs_data && ubi remove rootfs_data && ubi create rootfs_data - dynamic && reset
